<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>US States</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>

    <!-- Leaflet JavaScript code -->
    <!-- <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"
    integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q=="
    crossorigin=""></script> -->

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <!-- D3 library -->
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <!-- Our CSS-->
         <link rel="stylesheet" type="text/css" href="../static/css/style.css"> 

  </head>
  <body onload = "optionChanged(2011)">
    <h1>{{statedb.StateName}}</h1>
    <!-- map div -->
    <div id="plot"></div>
    <!-- <div id="map"></div> -->
    <select id="selDataset" onchange="optionChanged(parseInt(this.value))"></select>
    <div id="gauge"></div>
    <!-- <script type="text/javascript" src="../static/js/plots.js"></script> -->
    <script>
    
      
  
  
  function PlotState(state){
      year = [2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020]
      
      // d3.json("../static/data/state_data.json").then(function(dataset) {
      // console.log(dataset)
      // var state_dict = dataset;


      let happiness_trace = {
          x: year,
          y: {{statedb.happy_score}},
          type: 'line'
      };
      // console.log('-------------------------from html', {{statedb.DATE}});
      let data = [happiness_trace];
  
      let layout = {
      title: "Happiness of " + state
      };
  
      Plotly.newPlot("plot", data, layout);
  // })
}
  PlotState('{{state}}')
var counter = 0
  //Pathing to JSON file data 
  d3.select("#selDataset").html("");   

//    //Grab metadata array data for each item aka "ID" and append each ID to an item
  {{statedb.DATE}}.forEach(item => {
     d3.select ("#selDataset").append('option').attr('value', item).text(item);
     });
  function optionChanged(year){
  console.log('-------------------------from html', {{statedb.DATE}});


//    //Filter metadata based on selected ID

  var gauge = d3.select("#gauge");
    gauge.html(""); 
    var i = {{statedb.DATE}}.indexOf(year)
    var happinesScore = {{statedb.happy_score}}[i];
  console.log(i)
    //Create trace for gauge chart and formatting for chart
    var guageData = [{
    domain: { x: [0, 1], y: [0, 1] },
    value: happinesScore,
    title: { text: "<b>Belly Button Washing Frequency</b><br> (Scrubs Per Week)" },
    type: "indicator",
    mode: "gauge+number",     
       gauge: {
       axis: { range: [0,9] },
       bar: { color: "#FFAC61" },
       steps: [
          { range: [0, 1], color: "#6BFFFE" },
          { range: [1, 2], color: "#5DF0EF" },
          { range: [2, 3], color: "#50E1E0" },
          { range: [3, 4], color: "#42D3D2" },
          { range: [4, 5], color: "#35C4C3" },
          { range: [5, 6], color: "#28B5B4" },
          { range: [6, 7], color: "#1AA7A6" },
          { range: [7, 8], color: "#0D9897" },
          { range: [8, 9], color: "#008A89" }
          ],
       threshold: {
       value: happinesScore
       }}}
    ];
    var gaugeLayout = {  width: 500, 
                   height: 500, 
                   margin: { t: 0, b: 0 }, 
                   };
    Plotly.newPlot('gauge', guageData, gaugeLayout);
    var counter = 1 
                }
 
  //This needed to be added also so gauge would display on initial load
  
  if (counter === 0) {
  }
  
  // Added for consistancy
  // d3.select("#selDataset").on('change',() => {
  // optionChanged(d3.event.target.value);
  // });

  </script>




    <!-- <script src="../static/js/plots.js"></script> -->


  </body>
</html>
